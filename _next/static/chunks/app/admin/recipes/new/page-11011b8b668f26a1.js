(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5],{5369:function(e,n,t){Promise.resolve().then(t.bind(t,2104))},9453:function(e,n,t){"use strict";t.d(n,{default:function(){return c}});var i=t(7437),a=t(2265),r=t(6463),s=t(8614),l=t(5566);function c(e){let{children:n}=e,[t,c]=(0,a.useState)(!1),o=(0,r.useRouter)();return((0,a.useEffect)(()=>{(async function(){if("true"===l.env.NEXT_PUBLIC_SKIP_AUTH){c(!0);return}try{(await fetch("/api/auth/check")).ok?c(!0):o.push("/login")}catch(e){console.error("Authorization check failed:",e),o.push("/login")}})()},[o]),t)?(0,i.jsx)(s.Z,{children:n}):(0,i.jsx)("div",{children:"Checking authorization..."})}},708:function(e,n,t){"use strict";t.d(n,{Z:function(){return c}});var i=t(7437),a=t(2265),r=t(6648),s=t(2107),l=t(5170);function c(e){let{initialRecipe:n,onSubmit:t,isSubmitting:c}=e,[o,d]=(0,a.useState)(()=>({id:(null==n?void 0:n.id)||"",name:(null==n?void 0:n.name)||"",category:(null==n?void 0:n.category)||"",ingredients:(null==n?void 0:n.ingredients)||[{name:"",amount:""}],instructions:(null==n?void 0:n.instructions)||"",image:(null==n?void 0:n.image)||null})),[u,h]=(0,a.useState)(null);(0,a.useEffect)(()=>{n&&n.image&&h((0,l.K)("/images/recipes/".concat(n.image)))},[n]);let m=e=>{d({...o,[e.target.name]:e.target.value})},p=async e=>{var n;let t=null===(n=e.target.files)||void 0===n?void 0:n[0];if(t)try{let e=await (0,s.Z)(t,{maxSizeMB:1,maxWidthOrHeight:1920,useWebWorker:!0}),n=new FileReader;n.onloadend=()=>{let e=n.result;h(e),d({...o,image:e})},n.readAsDataURL(e)}catch(e){console.error("Error compressing image:",e)}},x=(e,n)=>{var t;let i=(null===(t=o.ingredients)||void 0===t?void 0:t.map((t,i)=>i===e?{...t,[n.target.name]:n.target.value}:t))||[];d({...o,ingredients:i})},f=e=>{var n;let t=(null===(n=o.ingredients)||void 0===n?void 0:n.filter((n,t)=>t!==e))||[];d({...o,ingredients:t})},g=async e=>{e.preventDefault();let n=new FormData;if(o.id&&n.append("id",o.id),o.name&&n.append("name",o.name),o.category&&n.append("category",o.category),o.instructions&&n.append("instructions",o.instructions),o.ingredients&&n.append("ingredients",JSON.stringify(o.ingredients)),o.image)try{let e=await fetch(o.image).then(e=>e.blob());n.append("image",e,"image.jpg")}catch(e){console.error("Error processing image:",e)}await t(n)};return(0,i.jsxs)("form",{onSubmit:g,className:"space-y-4",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block",children:"レシピ名:"}),(0,i.jsx)("input",{type:"text",name:"name",value:o.name,onChange:m,className:"w-full p-2 border rounded",required:!0})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block",children:"カテゴリー:"}),(0,i.jsx)("input",{type:"text",name:"category",value:o.category,onChange:m,className:"w-full p-2 border rounded"})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block",children:"材料:"}),o.ingredients.map((e,n)=>(0,i.jsxs)("div",{className:"flex space-x-2 mb-2",children:[(0,i.jsx)("input",{type:"text",name:"name",value:e.name,onChange:e=>x(n,e),placeholder:"材料名",className:"flex-1 p-2 border rounded"}),(0,i.jsx)("input",{type:"text",name:"amount",value:e.amount,onChange:e=>x(n,e),placeholder:"量",className:"w-1/3 p-2 border rounded"}),(0,i.jsx)("button",{type:"button",onClick:()=>f(n),className:"text-red-500",children:"削除"})]},n)),(0,i.jsx)("button",{type:"button",onClick:()=>{d({...o,ingredients:[...o.ingredients||[],{name:"",amount:""}]})},className:"text-blue-500",children:"+ 材料を追加"})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block",children:"作り方:"}),(0,i.jsx)("textarea",{name:"instructions",value:o.instructions,onChange:m,className:"w-full p-2 border rounded",rows:4})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block",children:"レシピ画像:"}),(0,i.jsx)("input",{type:"file",accept:"image/*",onChange:p,className:"w-full p-2 border rounded"}),u&&(0,i.jsx)("div",{className:"mt-2",children:(0,i.jsx)(r.default,{src:u,alt:"Recipe preview",width:200,height:200,objectFit:"cover"})})]}),(0,i.jsx)("button",{type:"submit",className:"bg-blue-500 text-white px-4 py-2 rounded disabled:bg-gray-400",disabled:c,children:c?"送信中...":n?"レシピを更新":"レシピを作成"})]})}},2104:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return c}});var i=t(7437),a=t(2265),r=t(6463),s=t(9453),l=t(708);function c(){let e=(0,r.useRouter)(),[n,t]=(0,a.useState)(!1),[c,o]=(0,a.useState)(!1);(0,a.useEffect)(()=>{o(!0)},[]);let d=async n=>{t(!0);try{if(!(await fetch("/api/recipes",{method:"POST",body:n})).ok)throw Error("Failed to create recipe");e.push("/admin/recipes")}catch(e){console.error("Error:",e),alert("レシピの作成に失敗しました")}finally{t(!1)}};return c?(0,i.jsxs)(s.default,{children:[(0,i.jsx)("h1",{className:"text-3xl font-bold mb-4",children:"新規レシピ作成"}),(0,i.jsx)(l.Z,{onSubmit:d,isSubmitting:n})]}):null}},5170:function(e,n,t){"use strict";t.d(n,{K:function(){return i}});let i=e=>"".concat("/bar-curion").concat(e)},8614:function(e,n,t){"use strict";t.d(n,{Z:function(){return r}});var i=t(7437),a=t(7138);function r(e){let{children:n}=e;return(0,i.jsxs)("div",{className:"container mx-auto px-4",children:[(0,i.jsx)("header",{className:"py-4",children:(0,i.jsx)("nav",{children:(0,i.jsxs)("ul",{className:"flex space-x-4",children:[(0,i.jsx)("li",{children:(0,i.jsx)(a.default,{href:"/",children:"ホーム"})}),(0,i.jsx)("li",{children:(0,i.jsx)(a.default,{href:"/recipes",children:"レシピ一覧"})}),(0,i.jsx)("li",{children:(0,i.jsx)(a.default,{href:"/graph",children:"関係グラフ"})}),(0,i.jsx)("li",{children:(0,i.jsx)(a.default,{href:"/admin",children:"管理画面"})})]})})}),(0,i.jsx)("main",{children:n}),(0,i.jsx)("footer",{className:"py-4 mt-8 border-t",children:(0,i.jsx)("p",{children:"\xa9 2024 Bar Curion"})})]})}}},function(e){e.O(0,[138,648,282,971,23,744],function(){return e(e.s=5369)}),_N_E=e.O()}]);