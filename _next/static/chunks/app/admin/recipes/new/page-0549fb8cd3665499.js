(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5],{5369:function(e,n,t){Promise.resolve().then(t.bind(t,2104))},9453:function(e,n,t){"use strict";t.d(n,{default:function(){return c}});var i=t(7437),a=t(2265),r=t(6463),s=t(8614),l=t(5566);function c(e){let{children:n}=e,[t,c]=(0,a.useState)(!1),d=(0,r.useRouter)();return((0,a.useEffect)(()=>{(async function(){if("true"===l.env.NEXT_PUBLIC_SKIP_AUTH){c(!0);return}try{(await fetch("/api/auth/check")).ok?c(!0):d.push("/login")}catch(e){console.error("Authorization check failed:",e),d.push("/login")}})()},[d]),t)?(0,i.jsx)(s.Z,{children:n}):(0,i.jsx)("div",{children:"Checking authorization..."})}},708:function(e,n,t){"use strict";t.d(n,{Z:function(){return l}});var i=t(7437),a=t(2265),r=t(6648),s=t(2107);function l(e){let{initialRecipe:n,onSubmit:t,isSubmitting:l}=e,[c,d]=(0,a.useState)(()=>({id:(null==n?void 0:n.id)||"",name:(null==n?void 0:n.name)||"",category:(null==n?void 0:n.category)||"",ingredients:(null==n?void 0:n.ingredients)||[{name:"",amount:""}],instructions:(null==n?void 0:n.instructions)||"",image:(null==n?void 0:n.image)||null})),[o,u]=(0,a.useState)(null);(0,a.useEffect)(()=>{n&&n.image&&u("/images/recipes/".concat(n.image))},[n]);let h=e=>{d({...c,[e.target.name]:e.target.value})},m=async e=>{var n;let t=null===(n=e.target.files)||void 0===n?void 0:n[0];if(t)try{let e=await (0,s.Z)(t,{maxSizeMB:1,maxWidthOrHeight:1920,useWebWorker:!0}),n=new FileReader;n.onloadend=()=>{let e=n.result;u(e),d({...c,image:e})},n.readAsDataURL(e)}catch(e){console.error("Error compressing image:",e)}},p=(e,n)=>{var t;let i=(null===(t=c.ingredients)||void 0===t?void 0:t.map((t,i)=>i===e?{...t,[n.target.name]:n.target.value}:t))||[];d({...c,ingredients:i})},x=e=>{var n;let t=(null===(n=c.ingredients)||void 0===n?void 0:n.filter((n,t)=>t!==e))||[];d({...c,ingredients:t})},f=async e=>{e.preventDefault();let n=new FormData;if(c.id&&n.append("id",c.id),c.name&&n.append("name",c.name),c.category&&n.append("category",c.category),c.instructions&&n.append("instructions",c.instructions),c.ingredients&&n.append("ingredients",JSON.stringify(c.ingredients)),c.image)try{let e=await fetch(c.image).then(e=>e.blob());n.append("image",e,"image.jpg")}catch(e){console.error("Error processing image:",e)}await t(n)};return(0,i.jsxs)("form",{onSubmit:f,className:"space-y-4",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block",children:"レシピ名:"}),(0,i.jsx)("input",{type:"text",name:"name",value:c.name,onChange:h,className:"w-full p-2 border rounded",required:!0})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block",children:"カテゴリー:"}),(0,i.jsx)("input",{type:"text",name:"category",value:c.category,onChange:h,className:"w-full p-2 border rounded"})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block",children:"材料:"}),c.ingredients.map((e,n)=>(0,i.jsxs)("div",{className:"flex space-x-2 mb-2",children:[(0,i.jsx)("input",{type:"text",name:"name",value:e.name,onChange:e=>p(n,e),placeholder:"材料名",className:"flex-1 p-2 border rounded"}),(0,i.jsx)("input",{type:"text",name:"amount",value:e.amount,onChange:e=>p(n,e),placeholder:"量",className:"w-1/3 p-2 border rounded"}),(0,i.jsx)("button",{type:"button",onClick:()=>x(n),className:"text-red-500",children:"削除"})]},n)),(0,i.jsx)("button",{type:"button",onClick:()=>{d({...c,ingredients:[...c.ingredients||[],{name:"",amount:""}]})},className:"text-blue-500",children:"+ 材料を追加"})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block",children:"作り方:"}),(0,i.jsx)("textarea",{name:"instructions",value:c.instructions,onChange:h,className:"w-full p-2 border rounded",rows:4})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block",children:"レシピ画像:"}),(0,i.jsx)("input",{type:"file",accept:"image/*",onChange:m,className:"w-full p-2 border rounded"}),o&&(0,i.jsx)("div",{className:"mt-2",children:(0,i.jsx)(r.default,{src:o,alt:"Recipe preview",width:200,height:200,objectFit:"cover"})})]}),(0,i.jsx)("button",{type:"submit",className:"bg-blue-500 text-white px-4 py-2 rounded disabled:bg-gray-400",disabled:l,children:l?"送信中...":n?"レシピを更新":"レシピを作成"})]})}},2104:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return c}});var i=t(7437),a=t(2265),r=t(6463),s=t(9453),l=t(708);function c(){let e=(0,r.useRouter)(),[n,t]=(0,a.useState)(!1),[c,d]=(0,a.useState)(!1);(0,a.useEffect)(()=>{d(!0)},[]);let o=async n=>{t(!0);try{if(!(await fetch("/api/recipes",{method:"POST",body:n})).ok)throw Error("Failed to create recipe");e.push("/admin/recipes")}catch(e){console.error("Error:",e),alert("レシピの作成に失敗しました")}finally{t(!1)}};return c?(0,i.jsxs)(s.default,{children:[(0,i.jsx)("h1",{className:"text-3xl font-bold mb-4",children:"新規レシピ作成"}),(0,i.jsx)(l.Z,{onSubmit:o,isSubmitting:n})]}):null}},8614:function(e,n,t){"use strict";t.d(n,{Z:function(){return r}});var i=t(7437),a=t(7138);function r(e){let{children:n}=e;return(0,i.jsxs)("div",{className:"container mx-auto px-4",children:[(0,i.jsx)("header",{className:"py-4",children:(0,i.jsx)("nav",{children:(0,i.jsxs)("ul",{className:"flex space-x-4",children:[(0,i.jsx)("li",{children:(0,i.jsx)(a.default,{href:"/",children:"ホーム"})}),(0,i.jsx)("li",{children:(0,i.jsx)(a.default,{href:"/recipes",children:"レシピ一覧"})}),(0,i.jsx)("li",{children:(0,i.jsx)(a.default,{href:"/graph",children:"関係グラフ"})}),(0,i.jsx)("li",{children:(0,i.jsx)(a.default,{href:"/admin",children:"管理画面"})})]})})}),(0,i.jsx)("main",{children:n}),(0,i.jsx)("footer",{className:"py-4 mt-8 border-t",children:(0,i.jsx)("p",{children:"\xa9 2024 Bar Curion"})})]})}}},function(e){e.O(0,[231,974,282,971,23,744],function(){return e(e.s=5369)}),_N_E=e.O()}]);