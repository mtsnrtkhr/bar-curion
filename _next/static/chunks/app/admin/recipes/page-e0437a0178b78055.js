(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[856],{8632:function(e,t,n){Promise.resolve().then(n.bind(n,4360))},9453:function(e,t,n){"use strict";n.d(t,{default:function(){return o}});var r=n(7437),i=n(2265),c=n(6463),a=n(8614),s=n(5566);function o(e){let{children:t}=e,[n,o]=(0,i.useState)(!1),l=(0,c.useRouter)();return((0,i.useEffect)(()=>{(async function(){if("true"===s.env.NEXT_PUBLIC_SKIP_AUTH){o(!0);return}try{(await fetch("/api/auth/check")).ok?o(!0):l.push("/login")}catch(e){console.error("Authorization check failed:",e),l.push("/login")}})()},[l]),n)?(0,r.jsx)(a.Z,{children:t}):(0,r.jsx)("div",{children:"Checking authorization..."})}},4360:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return o}});var r=n(7437),i=n(2265),c=n(7138),a=n(9453),s=n(3039);function o(){let[e,t]=(0,i.useState)([]),[n,o]=(0,i.useState)([]),[l,u]=(0,i.useState)(!0);(0,i.useEffect)(()=>{d()},[]);let d=async()=>{try{u(!0);let e=await fetch("/api/recipes");if(!e.ok)throw Error("Failed to fetch recipes");let n=await e.json();t(n.cocktails),o(n.cocktails)}catch(e){console.error("Error fetching recipes:",e),alert("レシピの取得に失敗しました")}finally{u(!1)}};return(0,r.jsxs)(a.default,{children:[(0,r.jsx)("h1",{className:"text-3xl font-bold mb-4",children:"レシピ管理"}),(0,r.jsx)(c.default,{href:"/admin/recipes/new",className:"mb-4 inline-block bg-blue-500 text-white px-4 py-2 rounded",children:"新規レシピ作成"}),(0,r.jsx)(s.Z,{onSearch:t=>{o(e.filter(e=>e.name.toLowerCase().includes(t.toLowerCase())||e.category.toLowerCase().includes(t.toLowerCase())||e.ingredients.some(e=>e.name.toLowerCase().includes(t.toLowerCase()))))}}),l?(0,r.jsx)("p",{children:"Loading..."}):(0,r.jsx)("ul",{className:"space-y-2",children:n.map(e=>(0,r.jsx)("li",{className:"border p-2 rounded",children:(0,r.jsxs)(c.default,{href:"/admin/recipes/".concat(e.id),children:[e.name," - ",e.category]})},e.id))})]})}},5170:function(e,t,n){"use strict";n.d(t,{K:function(){return r}});let r=e=>"".concat("/bar-curion").concat(e)},6463:function(e,t,n){"use strict";var r=n(1169);n.o(r,"useRouter")&&n.d(t,{useRouter:function(){return r.useRouter}})},5566:function(e){var t,n,r,i=e.exports={};function c(){throw Error("setTimeout has not been defined")}function a(){throw Error("clearTimeout has not been defined")}function s(e){if(t===setTimeout)return setTimeout(e,0);if((t===c||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:c}catch(e){t=c}try{n="function"==typeof clearTimeout?clearTimeout:a}catch(e){n=a}}();var o=[],l=!1,u=-1;function d(){l&&r&&(l=!1,r.length?o=r.concat(o):u=-1,o.length&&h())}function h(){if(!l){var e=s(d);l=!0;for(var t=o.length;t;){for(r=o,o=[];++u<t;)r&&r[u].run();u=-1,t=o.length}r=null,l=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===a||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function m(){}i.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];o.push(new f(e,t)),1!==o.length||l||s(h)},f.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=m,i.addListener=m,i.once=m,i.off=m,i.removeListener=m,i.removeAllListeners=m,i.emit=m,i.prependListener=m,i.prependOnceListener=m,i.listeners=function(e){return[]},i.binding=function(e){throw Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw Error("process.chdir is not supported")},i.umask=function(){return 0}},8614:function(e,t,n){"use strict";n.d(t,{Z:function(){return c}});var r=n(7437),i=n(7138);function c(e){let{children:t}=e;return(0,r.jsxs)("div",{className:"container mx-auto px-4",children:[(0,r.jsx)("header",{className:"py-4",children:(0,r.jsx)("nav",{children:(0,r.jsxs)("ul",{className:"flex space-x-4",children:[(0,r.jsx)("li",{children:(0,r.jsx)(i.default,{href:"/",children:"ホーム"})}),(0,r.jsx)("li",{children:(0,r.jsx)(i.default,{href:"/recipes",children:"レシピ一覧"})}),(0,r.jsx)("li",{children:(0,r.jsx)(i.default,{href:"/graph",children:"関係グラフ"})}),(0,r.jsx)("li",{children:(0,r.jsx)(i.default,{href:"/admin",children:"管理画面"})})]})})}),(0,r.jsx)("main",{children:t}),(0,r.jsx)("footer",{className:"py-4 mt-8 border-t",children:(0,r.jsx)("p",{children:"\xa9 2024 Bar Curion"})})]})}},3039:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});var r=n(7437),i=n(2265),c=n(6073);function a(e){let{onSearch:t}=e,[n,a]=(0,i.useState)(""),[s,o]=(0,i.useState)("simple"),l=async e=>{e.preventDefault();try{let e=await (0,c.s8)(n,"advanced"===s);t(e)}catch(e){console.error("Search error:",e)}};return(0,r.jsxs)("form",{onSubmit:l,className:"mb-4",children:[(0,r.jsxs)("div",{className:"mb-2",children:[(0,r.jsxs)("label",{className:"mr-4",children:[(0,r.jsx)("input",{type:"radio",value:"simple",checked:"simple"===s,onChange:()=>o("simple")}),"簡易検索"]}),(0,r.jsxs)("label",{children:[(0,r.jsx)("input",{type:"radio",value:"advanced",checked:"advanced"===s,onChange:()=>o("advanced")}),"高度な検索"]})]}),(0,r.jsx)("input",{type:"text",value:n,onChange:e=>a(e.target.value),placeholder:"simple"===s?"レシピ名、材料、カテゴリーでレシピを検索...":"例: ingredients:ジン category:クラシック",className:"w-full p-2 border rounded  text-black"}),(0,r.jsx)("button",{type:"submit",className:"mt-2 bg-blue-500 text-white px-4 py-2 rounded",children:"検索"}),"simple"===s&&(0,r.jsx)("p",{className:"mt-2 text-sm text-gray-600",children:'ヒント: 複数のキーワードはAND検索になります。完全一致検索には""を使用してください。 例: "ドライ マティーニ" ジン'}),"advanced"===s&&(0,r.jsx)("p",{className:"mt-2 text-sm text-gray-600",children:"高度な検索: キーを指定して検索できます（キー: name, ingredients, ingredients.name, ingredients.type, ingredients.amount, instructions, category:）。 標準は完全一致で、前方一致には末尾に*、後方一致には先頭に*を使用できます。 除外検索にはキーの前に-を付けてください。 ingredientsは詳細なキーを指定しない場合は全項目が検索対象になります。 例: -ingredients:クリーム,*ティーニ name:ホッパー"})]})}},6073:function(e,t,n){"use strict";n.d(t,{Fu:function(){return y},wb:function(){return g},iM:function(){return p},k2:function(){return m},s8:function(){return x}});var r=n(9879),i=n(354),c=n(5170),a=n(3750),s=n(7934);async function o(e,t){let n=function(e){let t=[];function n(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("alcohl_contents"==e);else{if("ingredients"==e){let r=t.map(e=>e.startsWith("*")&&e.endsWith("*")?"val.toString().match(/".concat(e.slice(1,-1),"/i)"):e.startsWith("*")?"val.toString().match(/".concat(e.slice(1),"$/i)"):e.endsWith("*")?"val.toString().match(/^".concat(e.slice(0,-1),"/i)"):'val.toString() == "'.concat(e,'"')).join(" || ");return n?"!@.".concat(e,".some(function($i){return (Object.values($i).some(function(val) { return (").concat(r,") }))})"):"@.".concat(e,".some(function($i){return (Object.values($i).some(function(val) { return (").concat(r,") }))})")}if(e.startsWith("ingredients.")){let r=e.split(".")[1],i=t.map(e=>e.startsWith("*")&&e.endsWith("*")?"$i.".concat(r,".match(/").concat(e.slice(1,-1),"/i)"):e.startsWith("*")?"$i.".concat(r,".match(/").concat(e.slice(1),"$/i)"):e.endsWith("*")?"$i.".concat(r,".match(/^").concat(e.slice(0,-1),"/i)"):"$i.".concat(r,' == "').concat(e,'"')).join(" || ");return n?"!@.ingredients.some(function($i){ return (".concat(i,") })"):"@.ingredients.some(function($i){ return (".concat(i,") })")}{let r=t.map(t=>t.startsWith("*")&&t.endsWith("*")?"@.".concat(e,".match(/").concat(t.slice(1,-1),"/i)"):t.startsWith("*")?"@.".concat(e,".match(/").concat(t.slice(1),"$/i)"):t.endsWith("*")?"@.".concat(e,".match(/^").concat(t.slice(0,-1),"/i)"):"@.".concat(e,' == "').concat(t,'"')).join(" || ");return n?"!(".concat(r,")"):"(".concat(r,")")}}}return Object.entries(e).forEach(e=>{let[r,i]=e;console.log("key:",r),console.log("values:",i,Array.isArray(i));let c=!1;"exclude"===r?0!==Object.keys(i).length&&(c=!0,r=Object.keys(i)[0],i=i[r],console.log("key:",r),console.log("values:",i),t.push("".concat(n(r,i,c)))):t.push("".concat(n(r,i,c)))}),t.length>0?"$[?(".concat(t.join(" && "),")]"):"$[*]"}(a.parse(e,{keywords:["ingredients","name","ingredients.name","ingredients.type","ingredients.amount","instructions","category"],ranges:["alcohol_content"],alwaysArray:!0,offsets:!1}));return console.log("JsonPath Query:",n),(0,s.j)({path:n,json:t,eval:"native"}).map(e=>e.id)}let l=null,u=null,d=null;async function h(e){let t=new r.z,n=new i.P(t,{});try{let t;{let n=await fetch((0,c.K)(e));if(!n.ok)throw Error("HTTP error! status: ".concat(n.status));t=await n.json()}n.data=t,await n.write()}catch(e){throw console.error("Error in initDb:",e),e}return n}async function f(e){let t=e.data.cocktails,n=e.data.ingredients;return t.map(e=>({...e,ingredients:e.ingredients.map(e=>{let t=n.find(t=>t.id===e.ingredient_id);return t?{...e,...t,products:t.products.map(e=>({...e,product_id:e.product_id}))}:e})}))}async function m(){l||(l=await h("/data/recipes.json")),u||(u=await h("/data/graph-data.json")),d||(d=await f(l))}async function p(){return await m(),l.data.cocktails}async function g(e){return await m(),l.data.cocktails.find(t=>t.id===parseInt(e))||null}async function y(){return await m(),u.data}async function x(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];await m();let n=l,r=n.data.cocktails,i=n.data.ingredients;if(t)try{let t=await o(e,d);console.log(t);let n=Array.from(t).map(e=>g(e)),r=await Promise.all(n);return console.log(r),r}catch(e){return console.error("Advanced search error:",e),[]}else{let t=e.match(/"[^"]+"|[^\s]+/g)||[];return r.filter(e=>t.every(t=>{let n=t.startsWith('"')&&t.endsWith('"'),r=t.replace(/^"|"$/g,"").toLowerCase(),c=e=>{if("string"!=typeof e)return!1;let t=e.toLowerCase();return n?t===r:t.includes(r)};return c(e.name)||c(e.category)||e.ingredients.some(e=>c(e.name))||i.some(t=>c(t.name)&&e.ingredients.some(e=>e.id===t.id))}))}}}},function(e){e.O(0,[138,37,971,23,744],function(){return e(e.s=8632)}),_N_E=e.O()}]);