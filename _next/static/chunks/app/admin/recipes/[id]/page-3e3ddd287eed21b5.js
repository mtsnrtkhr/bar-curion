(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[755],{8603:function(e,t,n){Promise.resolve().then(n.bind(n,3736))},9453:function(e,t,n){"use strict";n.d(t,{default:function(){return o}});var i=n(7437),a=n(2265),r=n(6463),c=n(8614),s=n(5566);function o(e){let{children:t}=e,[n,o]=(0,a.useState)(!1),l=(0,r.useRouter)();return((0,a.useEffect)(()=>{(async function(){if("true"===s.env.NEXT_PUBLIC_SKIP_AUTH){o(!0);return}try{(await fetch("/api/auth/check")).ok?o(!0):l.push("/login")}catch(e){console.error("Authorization check failed:",e),l.push("/login")}})()},[l]),n)?(0,i.jsx)(c.Z,{children:t}):(0,i.jsx)("div",{children:"Checking authorization..."})}},3736:function(e,t,n){"use strict";n.d(t,{default:function(){return l}});var i=n(7437),a=n(2265),r=n(6463),c=n(9453),s=n(708),o=n(6073);function l(e){let{id:t}=e,[n,l]=(0,a.useState)(null),[u,d]=(0,a.useState)(!1),h=(0,r.useRouter)();(0,a.useEffect)(()=>{!async function(){let e=await (0,o.wb)(t);e?l(e):h.push("/admin/recipes")}()},[t,h]);let m=async e=>{if(!n){alert("レシピデータが読み込まれていません");return}d(!0);try{if(!(await fetch("/api/recipes/".concat(t),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e.get("name"),category:e.get("category"),ingredients:JSON.parse(e.get("ingredients")),instructions:e.get("instructions"),image:n.image})})).ok)throw Error("Failed to update recipe");h.push("/admin/recipes")}catch(e){console.error("Error:",e),alert("レシピの更新に失敗しました")}finally{d(!1)}};return n?(0,i.jsxs)(c.default,{children:[(0,i.jsxs)("h1",{className:"text-3xl font-bold mb-4",children:["レシピ編集: ",n.name]}),(0,i.jsx)(s.Z,{initialRecipe:n,onSubmit:m,isSubmitting:u})]}):(0,i.jsx)("div",{children:"Loading..."})}},708:function(e,t,n){"use strict";n.d(t,{Z:function(){return o}});var i=n(7437),a=n(2265),r=n(6648),c=n(2107),s=n(5170);function o(e){let{initialRecipe:t,onSubmit:n,isSubmitting:o}=e,[l,u]=(0,a.useState)(()=>({id:(null==t?void 0:t.id)||"",name:(null==t?void 0:t.name)||"",category:(null==t?void 0:t.category)||"",ingredients:(null==t?void 0:t.ingredients)||[{name:"",amount:""}],instructions:(null==t?void 0:t.instructions)||"",image:(null==t?void 0:t.image)||null})),[d,h]=(0,a.useState)(null);(0,a.useEffect)(()=>{t&&t.image&&h((0,s.K)("/images/recipes/".concat(t.image)))},[t]);let m=e=>{u({...l,[e.target.name]:e.target.value})},g=async e=>{var t;let n=null===(t=e.target.files)||void 0===t?void 0:t[0];if(n)try{let e=await (0,c.Z)(n,{maxSizeMB:1,maxWidthOrHeight:1920,useWebWorker:!0}),t=new FileReader;t.onloadend=()=>{let e=t.result;h(e),u({...l,image:e})},t.readAsDataURL(e)}catch(e){console.error("Error compressing image:",e)}},f=(e,t)=>{var n;let i=(null===(n=l.ingredients)||void 0===n?void 0:n.map((n,i)=>i===e?{...n,[t.target.name]:t.target.value}:n))||[];u({...l,ingredients:i})},p=e=>{var t;let n=(null===(t=l.ingredients)||void 0===t?void 0:t.filter((t,n)=>n!==e))||[];u({...l,ingredients:n})},x=async e=>{e.preventDefault();let t=new FormData;if(l.id&&t.append("id",l.id),l.name&&t.append("name",l.name),l.category&&t.append("category",l.category),l.instructions&&t.append("instructions",l.instructions),l.ingredients&&t.append("ingredients",JSON.stringify(l.ingredients)),l.image)try{let e=await fetch(l.image).then(e=>e.blob());t.append("image",e,"image.jpg")}catch(e){console.error("Error processing image:",e)}await n(t)};return(0,i.jsxs)("form",{onSubmit:x,className:"space-y-4",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block",children:"レシピ名:"}),(0,i.jsx)("input",{type:"text",name:"name",value:l.name,onChange:m,className:"w-full p-2 border rounded",required:!0})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block",children:"カテゴリー:"}),(0,i.jsx)("input",{type:"text",name:"category",value:l.category,onChange:m,className:"w-full p-2 border rounded"})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block",children:"材料:"}),l.ingredients.map((e,t)=>(0,i.jsxs)("div",{className:"flex space-x-2 mb-2",children:[(0,i.jsx)("input",{type:"text",name:"name",value:e.name,onChange:e=>f(t,e),placeholder:"材料名",className:"flex-1 p-2 border rounded"}),(0,i.jsx)("input",{type:"text",name:"amount",value:e.amount,onChange:e=>f(t,e),placeholder:"量",className:"w-1/3 p-2 border rounded"}),(0,i.jsx)("button",{type:"button",onClick:()=>p(t),className:"text-red-500",children:"削除"})]},t)),(0,i.jsx)("button",{type:"button",onClick:()=>{u({...l,ingredients:[...l.ingredients||[],{name:"",amount:""}]})},className:"text-blue-500",children:"+ 材料を追加"})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block",children:"作り方:"}),(0,i.jsx)("textarea",{name:"instructions",value:l.instructions,onChange:m,className:"w-full p-2 border rounded",rows:4})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block",children:"レシピ画像:"}),(0,i.jsx)("input",{type:"file",accept:"image/*",onChange:g,className:"w-full p-2 border rounded"}),d&&(0,i.jsx)("div",{className:"mt-2",children:(0,i.jsx)(r.default,{src:d,alt:"Recipe preview",width:200,height:200,objectFit:"cover"})})]}),(0,i.jsx)("button",{type:"submit",className:"bg-blue-500 text-white px-4 py-2 rounded disabled:bg-gray-400",disabled:o,children:o?"送信中...":t?"レシピを更新":"レシピを作成"})]})}},5170:function(e,t,n){"use strict";n.d(t,{K:function(){return i}});let i=e=>"".concat("/bar-curion").concat(e)},8614:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});var i=n(7437),a=n(7138);function r(e){let{children:t}=e;return(0,i.jsxs)("div",{className:"container mx-auto px-4",children:[(0,i.jsx)("header",{className:"py-4",children:(0,i.jsx)("nav",{children:(0,i.jsxs)("ul",{className:"flex space-x-4",children:[(0,i.jsx)("li",{children:(0,i.jsx)(a.default,{href:"/",children:"ホーム"})}),(0,i.jsx)("li",{children:(0,i.jsx)(a.default,{href:"/recipes",children:"レシピ一覧"})}),(0,i.jsx)("li",{children:(0,i.jsx)(a.default,{href:"/graph",children:"関係グラフ"})}),(0,i.jsx)("li",{children:(0,i.jsx)(a.default,{href:"/admin",children:"管理画面"})})]})})}),(0,i.jsx)("main",{children:t}),(0,i.jsx)("footer",{className:"py-4 mt-8 border-t",children:(0,i.jsx)("p",{children:"\xa9 2024 Bar Curion"})})]})}},6073:function(e,t,n){"use strict";n.d(t,{Fu:function(){return x},wb:function(){return p},iM:function(){return f},k2:function(){return g},s8:function(){return y}});var i=n(9879),a=n(354),r=n(5170),c=n(3750),s=n(7934);async function o(e,t){let n=function(e){let t=[];function n(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("alcohl_contents"==e);else{if("ingredients"==e){let i=t.map(e=>e.startsWith("*")&&e.endsWith("*")?"val.toString().match(/".concat(e.slice(1,-1),"/i)"):e.startsWith("*")?"val.toString().match(/".concat(e.slice(1),"$/i)"):e.endsWith("*")?"val.toString().match(/^".concat(e.slice(0,-1),"/i)"):'val.toString() == "'.concat(e,'"')).join(" || ");return n?"!@.".concat(e,".some(function($i){return (Object.values($i).some(function(val) { return (").concat(i,") }))})"):"@.".concat(e,".some(function($i){return (Object.values($i).some(function(val) { return (").concat(i,") }))})")}if(e.startsWith("ingredients.")){let i=e.split(".")[1],a=t.map(e=>e.startsWith("*")&&e.endsWith("*")?"$i.".concat(i,".match(/").concat(e.slice(1,-1),"/i)"):e.startsWith("*")?"$i.".concat(i,".match(/").concat(e.slice(1),"$/i)"):e.endsWith("*")?"$i.".concat(i,".match(/^").concat(e.slice(0,-1),"/i)"):"$i.".concat(i,' == "').concat(e,'"')).join(" || ");return n?"!@.ingredients.some(function($i){ return (".concat(a,") })"):"@.ingredients.some(function($i){ return (".concat(a,") })")}{let i=t.map(t=>t.startsWith("*")&&t.endsWith("*")?"@.".concat(e,".match(/").concat(t.slice(1,-1),"/i)"):t.startsWith("*")?"@.".concat(e,".match(/").concat(t.slice(1),"$/i)"):t.endsWith("*")?"@.".concat(e,".match(/^").concat(t.slice(0,-1),"/i)"):"@.".concat(e,' == "').concat(t,'"')).join(" || ");return n?"!(".concat(i,")"):"(".concat(i,")")}}}return Object.entries(e).forEach(e=>{let[i,a]=e;console.log("key:",i),console.log("values:",a,Array.isArray(a));let r=!1;"exclude"===i?0!==Object.keys(a).length&&(r=!0,i=Object.keys(a)[0],a=a[i],console.log("key:",i),console.log("values:",a),t.push("".concat(n(i,a,r)))):t.push("".concat(n(i,a,r)))}),t.length>0?"$[?(".concat(t.join(" && "),")]"):"$[*]"}(c.parse(e,{keywords:["ingredients","name","ingredients.name","ingredients.type","ingredients.amount","instructions","category"],ranges:["alcohol_content"],alwaysArray:!0,offsets:!1}));return console.log("JsonPath Query:",n),(0,s.j)({path:n,json:t,eval:"native"}).map(e=>e.id)}let l=null,u=null,d=null;async function h(e){let t=new i.z,n=new a.P(t,{});try{let t;{let n=await fetch((0,r.K)(e));if(!n.ok)throw Error("HTTP error! status: ".concat(n.status));t=await n.json()}n.data=t,await n.write()}catch(e){throw console.error("Error in initDb:",e),e}return n}async function m(e){let t=e.data.cocktails,n=e.data.ingredients;return t.map(e=>({...e,ingredients:e.ingredients.map(e=>{let t=n.find(t=>t.id===e.ingredient_id);return t?{...e,...t,products:t.products.map(e=>({...e,product_id:e.product_id}))}:e})}))}async function g(){l||(l=await h("/data/recipes.json")),u||(u=await h("/data/graph-data.json")),d||(d=await m(l))}async function f(){return await g(),l.data.cocktails}async function p(e){return await g(),l.data.cocktails.find(t=>t.id===parseInt(e))||null}async function x(){return await g(),u.data}async function y(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];await g();let n=l,i=n.data.cocktails,a=n.data.ingredients;if(t)try{let t=await o(e,d);console.log(t);let n=Array.from(t).map(e=>p(e)),i=await Promise.all(n);return console.log(i),i}catch(e){return console.error("Advanced search error:",e),[]}else{let t=e.match(/"[^"]+"|[^\s]+/g)||[];return i.filter(e=>t.every(t=>{let n=t.startsWith('"')&&t.endsWith('"'),i=t.replace(/^"|"$/g,"").toLowerCase(),r=e=>{if("string"!=typeof e)return!1;let t=e.toLowerCase();return n?t===i:t.includes(i)};return r(e.name)||r(e.category)||e.ingredients.some(e=>r(e.name))||a.some(t=>r(t.name)&&e.ingredients.some(e=>e.id===t.id))}))}}}},function(e){e.O(0,[138,37,648,282,971,23,744],function(){return e(e.s=8603)}),_N_E=e.O()}]);