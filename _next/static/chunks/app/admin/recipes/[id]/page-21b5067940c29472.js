(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[755],{8603:function(e,t,n){Promise.resolve().then(n.bind(n,3736))},9453:function(e,t,n){"use strict";n.d(t,{default:function(){return c}});var a=n(7437),i=n(2265),r=n(6463),s=n(8614),l=n(5566);function c(e){let{children:t}=e,[n,c]=(0,i.useState)(!1),o=(0,r.useRouter)();return((0,i.useEffect)(()=>{(async function(){if("true"===l.env.NEXT_PUBLIC_SKIP_AUTH){c(!0);return}try{(await fetch("/api/auth/check")).ok?c(!0):o.push("/login")}catch(e){console.error("Authorization check failed:",e),o.push("/login")}})()},[o]),n)?(0,a.jsx)(s.Z,{children:t}):(0,a.jsx)("div",{children:"Checking authorization..."})}},3736:function(e,t,n){"use strict";n.d(t,{default:function(){return o}});var a=n(7437),i=n(2265),r=n(6463),s=n(9453),l=n(708),c=n(2215);function o(e){let{id:t}=e,[n,o]=(0,i.useState)(null),[d,u]=(0,i.useState)(!1),h=(0,r.useRouter)();(0,i.useEffect)(()=>{!async function(){let e=await (0,c.wb)(t);e?o(e):h.push("/admin/recipes")}()},[t,h]);let m=async e=>{if(!n){alert("レシピデータが読み込まれていません");return}u(!0);try{if(!(await fetch("/api/recipes/".concat(t),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e.get("name"),category:e.get("category"),ingredients:JSON.parse(e.get("ingredients")),instructions:e.get("instructions"),image:n.image})})).ok)throw Error("Failed to update recipe");h.push("/admin/recipes")}catch(e){console.error("Error:",e),alert("レシピの更新に失敗しました")}finally{u(!1)}};return n?(0,a.jsxs)(s.default,{children:[(0,a.jsxs)("h1",{className:"text-3xl font-bold mb-4",children:["レシピ編集: ",n.name]}),(0,a.jsx)(l.Z,{initialRecipe:n,onSubmit:m,isSubmitting:d})]}):(0,a.jsx)("div",{children:"Loading..."})}},708:function(e,t,n){"use strict";n.d(t,{Z:function(){return l}});var a=n(7437),i=n(2265),r=n(6648),s=n(2107);function l(e){let{initialRecipe:t,onSubmit:n,isSubmitting:l}=e,[c,o]=(0,i.useState)(()=>({id:(null==t?void 0:t.id)||"",name:(null==t?void 0:t.name)||"",category:(null==t?void 0:t.category)||"",ingredients:(null==t?void 0:t.ingredients)||[{name:"",amount:""}],instructions:(null==t?void 0:t.instructions)||"",image:(null==t?void 0:t.image)||null})),[d,u]=(0,i.useState)(null);(0,i.useEffect)(()=>{t&&t.image&&u("/images/recipes/".concat(t.image))},[t]);let h=e=>{o({...c,[e.target.name]:e.target.value})},m=async e=>{var t;let n=null===(t=e.target.files)||void 0===t?void 0:t[0];if(n)try{let e=await (0,s.Z)(n,{maxSizeMB:1,maxWidthOrHeight:1920,useWebWorker:!0}),t=new FileReader;t.onloadend=()=>{let e=t.result;u(e),o({...c,image:e})},t.readAsDataURL(e)}catch(e){console.error("Error compressing image:",e)}},f=(e,t)=>{var n;let a=(null===(n=c.ingredients)||void 0===n?void 0:n.map((n,a)=>a===e?{...n,[t.target.name]:t.target.value}:n))||[];o({...c,ingredients:a})},p=e=>{var t;let n=(null===(t=c.ingredients)||void 0===t?void 0:t.filter((t,n)=>n!==e))||[];o({...c,ingredients:n})},g=async e=>{e.preventDefault();let t=new FormData;if(c.id&&t.append("id",c.id),c.name&&t.append("name",c.name),c.category&&t.append("category",c.category),c.instructions&&t.append("instructions",c.instructions),c.ingredients&&t.append("ingredients",JSON.stringify(c.ingredients)),c.image)try{let e=await fetch(c.image).then(e=>e.blob());t.append("image",e,"image.jpg")}catch(e){console.error("Error processing image:",e)}await n(t)};return(0,a.jsxs)("form",{onSubmit:g,className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block",children:"レシピ名:"}),(0,a.jsx)("input",{type:"text",name:"name",value:c.name,onChange:h,className:"w-full p-2 border rounded",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block",children:"カテゴリー:"}),(0,a.jsx)("input",{type:"text",name:"category",value:c.category,onChange:h,className:"w-full p-2 border rounded"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block",children:"材料:"}),c.ingredients.map((e,t)=>(0,a.jsxs)("div",{className:"flex space-x-2 mb-2",children:[(0,a.jsx)("input",{type:"text",name:"name",value:e.name,onChange:e=>f(t,e),placeholder:"材料名",className:"flex-1 p-2 border rounded"}),(0,a.jsx)("input",{type:"text",name:"amount",value:e.amount,onChange:e=>f(t,e),placeholder:"量",className:"w-1/3 p-2 border rounded"}),(0,a.jsx)("button",{type:"button",onClick:()=>p(t),className:"text-red-500",children:"削除"})]},t)),(0,a.jsx)("button",{type:"button",onClick:()=>{o({...c,ingredients:[...c.ingredients||[],{name:"",amount:""}]})},className:"text-blue-500",children:"+ 材料を追加"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block",children:"作り方:"}),(0,a.jsx)("textarea",{name:"instructions",value:c.instructions,onChange:h,className:"w-full p-2 border rounded",rows:4})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block",children:"レシピ画像:"}),(0,a.jsx)("input",{type:"file",accept:"image/*",onChange:m,className:"w-full p-2 border rounded"}),d&&(0,a.jsx)("div",{className:"mt-2",children:(0,a.jsx)(r.default,{src:d,alt:"Recipe preview",width:200,height:200,objectFit:"cover"})})]}),(0,a.jsx)("button",{type:"submit",className:"bg-blue-500 text-white px-4 py-2 rounded disabled:bg-gray-400",disabled:l,children:l?"送信中...":t?"レシピを更新":"レシピを作成"})]})}},8614:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});var a=n(7437),i=n(7138);function r(e){let{children:t}=e;return(0,a.jsxs)("div",{className:"container mx-auto px-4",children:[(0,a.jsx)("header",{className:"py-4",children:(0,a.jsx)("nav",{children:(0,a.jsxs)("ul",{className:"flex space-x-4",children:[(0,a.jsx)("li",{children:(0,a.jsx)(i.default,{href:"/",children:"ホーム"})}),(0,a.jsx)("li",{children:(0,a.jsx)(i.default,{href:"/recipes",children:"レシピ一覧"})}),(0,a.jsx)("li",{children:(0,a.jsx)(i.default,{href:"/graph",children:"関係グラフ"})}),(0,a.jsx)("li",{children:(0,a.jsx)(i.default,{href:"/admin",children:"管理画面"})})]})})}),(0,a.jsx)("main",{children:t}),(0,a.jsx)("footer",{className:"py-4 mt-8 border-t",children:(0,a.jsx)("p",{children:"\xa9 2024 Bar Curion"})})]})}},2215:function(e,t,n){"use strict";n.d(t,{Fu:function(){return u},iM:function(){return o},k2:function(){return c},wb:function(){return d}});var a=n(9879),i=n(354);n(5312);let r=null,s=null;async function l(e){let t=new a.z,n=new i.P(t,{});try{let t;{let n=await fetch(e);if(!n.ok)throw Error("HTTP error! status: ".concat(n.status));t=await n.json()}n.data=t,await n.write()}catch(e){throw console.error("Error in initDb:",e),e}return n}async function c(){r||(r=await l("/data/recipes.json")),s||(s=await l("/data/graph-data.json"))}async function o(){return await c(),r.data.cocktails}async function d(e){return await c(),r.data.cocktails.find(t=>t.id===parseInt(e))||null}async function u(){return await c(),s.data}},9879:function(e,t,n){"use strict";n.d(t,{z:function(){return a}});class a{#e=null;read(){return Promise.resolve(this.#e)}write(e){return this.#e=e,Promise.resolve()}}},5312:function(){},354:function(e,t,n){"use strict";n.d(t,{P:function(){return a}});class a{adapter;data;constructor(e,t){!function(e,t){if(void 0===e)throw Error("lowdb: missing adapter");if(void 0===t)throw Error("lowdb: missing default data")}(e,t),this.adapter=e,this.data=t}async read(){let e=await this.adapter.read();e&&(this.data=e)}async write(){this.data&&await this.adapter.write(this.data)}async update(e){e(this.data),await this.write()}}}},function(e){e.O(0,[231,974,282,971,23,744],function(){return e(e.s=8603)}),_N_E=e.O()}]);